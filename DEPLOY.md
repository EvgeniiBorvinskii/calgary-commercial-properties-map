# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é ‚Äî Calgary Properties

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### –í–∞—Ä–∏–∞–Ω—Ç 1: NPM –∫–æ–º–∞–Ω–¥–∞
```bash
npm run deploy
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: VS Code Task
1. –ù–∞–∂–º–∏ `Ctrl+Shift+P` (–∏–ª–∏ `Cmd+Shift+P` –Ω–∞ Mac)
2. –í–≤–µ–¥–∏: **Tasks: Run Task**
3. –í—ã–±–µ—Ä–∏: **Deploy: calgary.ypilo.com**

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü—Ä—è–º–æ–π –∑–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞
```powershell
.\deploy-simple.ps1
```

---

## –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –¥–µ–ø–ª–æ–µ

1. **–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ `/srv/calgary.ypilo.com`
2. **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤** —á–µ—Ä–µ–∑ SCP:
   - `src/` (–≤–µ—Å—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥)
   - `package.json`, `package-lock.json`
   - `next.config.js`, `tsconfig.json`
   - `tailwind.config.ts`, `postcss.config.mjs`
   - `.env.local` (—Å Mapbox —Ç–æ–∫–µ–Ω–æ–º)

3. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
   ```bash
   npm install --legacy-peer-deps
   ```

4. **–°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞**:
   ```bash
   npm run build
   ```

5. **–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ PM2**:
   - –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–π –ø—Ä–æ—Ü–µ—Å—Å
   - –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–π –ø—Ä–æ—Ü–µ—Å—Å
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç –Ω–æ–≤—ã–π –Ω–∞ –ø–æ—Ä—Ç—É **3052**
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (`pm2 save`)

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å PM2
```bash
ssh root@5.249.160.54 'pm2 list'
```
–î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–æ—Ü–µ—Å—Å **calgary-properties** —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `online`.

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
```bash
ssh root@5.249.160.54 'pm2 logs calgary-properties --lines 20'
```
–î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `‚úì Ready in XXXms`

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
```bash
ssh root@5.249.160.54 'curl -I http://localhost:3052'
```
–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å `HTTP/1.1 200 OK`

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ nginx (–ø—Ä–æ–¥–∞–∫—à–µ–Ω)
–û—Ç–∫—Ä–æ–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ: **https://calgary.ypilo.com**

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –ü–æ—Ä—Ç—ã
- **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (Next.js)**: `3052`
- **Nginx (HTTPS)**: `443` ‚Üí –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –Ω–∞ `localhost:3052`

### –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

#### PM2 (–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
`/srv/calgary.ypilo.com/ecosystem.config.js`:
```javascript
module.exports = {
  apps: [{
    name: 'calgary-properties',
    script: 'node_modules/next/dist/bin/next',
    args: 'start -p 3052',
    cwd: '/srv/calgary.ypilo.com',
    instances: 1,
    autorestart: true,
    watch: false,
    max_memory_restart: '1G',
    env: {
      NODE_ENV: 'production',
      PORT: 3052,
      HOSTNAME: '0.0.0.0'
    }
  }]
}
```

#### Nginx (–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
`/etc/nginx/sites-available/calgary.ypilo.com`:
- –°–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 443 (HTTPS)
- –ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –Ω–∞ `http://localhost:3052`
- SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã: `/etc/letsencrypt/live/calgary.ypilo.com/`

---

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### PM2
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
pm2 logs calgary-properties

# –†–µ—Å—Ç–∞—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
pm2 restart calgary-properties

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
pm2 stop calgary-properties

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
pm2 monit

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
pm2 list
```

### Nginx
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
nginx -t

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å nginx
systemctl reload nginx

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –æ—à–∏–±–æ–∫
tail -f /var/log/nginx/calgary.ypilo.com.error.log

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –¥–æ—Å—Ç—É–ø–∞
tail -f /var/log/nginx/calgary.ypilo.com.access.log
```

### –ü–æ—Ä—Ç—ã
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫—Ç–æ —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 3052
ss -ltnp | grep 3052

# –£–±–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ –ø–æ—Ä—Ç—É 3052 (–µ—Å–ª–∏ –∑–∞–≤–∏—Å)
fuser -k 3052/tcp
```

---

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "502 Bad Gateway"
**–ü—Ä–∏—á–∏–Ω–∞**: Nginx –Ω–µ –º–æ–∂–µ—Ç –¥–æ—Å—Ç—É—á–∞—Ç—å—Å—è –¥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ: `pm2 list`
2. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ PM2: `pm2 logs calgary-properties`
3. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –ø–æ—Ä—Ç –≤ nginx —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –ø–æ—Ä—Ç–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
   ```bash
   ssh root@5.249.160.54 'grep proxy_pass /etc/nginx/sites-available/calgary.ypilo.com'
   ```
   –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `proxy_pass http://localhost:3052;`

### –ü—Ä–æ–±–ª–µ–º–∞: "EADDRINUSE" (–ø–æ—Ä—Ç –∑–∞–Ω—è—Ç)
**–ü—Ä–∏—á–∏–Ω–∞**: –°—Ç–∞—Ä—ã–π –ø—Ä–æ—Ü–µ—Å—Å –≤—Å—ë –µ—â—ë –¥–µ—Ä–∂–∏—Ç –ø–æ—Ä—Ç 3052

**–†–µ—à–µ–Ω–∏–µ**:
```bash
ssh root@5.249.160.54 'fuser -k 3052/tcp && pm2 restart calgary-properties'
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Failed to start server" –±–µ–∑ –¥–µ—Ç–∞–ª–µ–π
**–ü—Ä–∏—á–∏–Ω–∞**: –í–æ–∑–º–æ–∂–Ω–æ, –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `.env.local` –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π –ø—É—Ç—å

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞:
   ```bash
   ssh root@5.249.160.54 'ls -la /srv/calgary.ypilo.com/.env.local'
   ```
2. –ï—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç, –∑–∞–≥—Ä—É–∑–∏ –µ–≥–æ –≤—Ä—É—á–Ω—É—é:
   ```powershell
   scp .env.local root@5.249.160.54:/srv/calgary.ypilo.com/
   ```

---

## –í–∞–∂–Ω–æ ‚ö†Ô∏è

1. **–í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π –ª–æ–≥–∏ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è**: `pm2 logs calgary-properties`
2. **–ù–µ –∑–∞–±—É–¥—å `.env.local`**: —Ñ–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å `NEXT_PUBLIC_MAPBOX_TOKEN`
3. **–ü–æ—Ä—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å –≤–µ–∑–¥–µ**: ecosystem.config.js (3052) + nginx.conf (3052)
4. **SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã**: –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ certbot (Let's Encrypt)

---

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏

‚úÖ **Section-based loading**: –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑–¥–µ–ª (WHOLESALE), –∞ –Ω–µ –≤—Å–µ 21,875 –æ–±—ä–µ–∫—Ç–æ–≤  
‚úÖ **–°–µ—Ä–≤–µ—Ä–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `?type=WHOLESALE` –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ JSON  
‚úÖ **–û—Ç–∫–ª—é—á—ë–Ω auto-pan –Ω–∞ hover**: –ö–∞—Ä—Ç–∞ –Ω–µ –¥–≤–∏–≥–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –º–∞—Ä–∫–µ—Ä (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–ª–∞—Å—Ç–µ—Ä –∏–ª–∏ —è–≤–Ω–æ–º –≤—ã–±–æ—Ä–µ)  
‚úÖ **–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–µ –º–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é**: –ú–µ–Ω—é –±–æ–ª—å—à–µ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∫–∞—Ä—Ç—É, –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω  

---

–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 20 —è–Ω–≤–∞—Ä—è 2026
