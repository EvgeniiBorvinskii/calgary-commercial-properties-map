"use strict";(()=>{var e={};e.id=886,e.ids=[886],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7790:e=>{e.exports=require("assert")},4770:e=>{e.exports=require("crypto")},7702:e=>{e.exports=require("events")},2048:e=>{e.exports=require("fs")},2615:e=>{e.exports=require("http")},2694:e=>{e.exports=require("http2")},5240:e=>{e.exports=require("https")},9801:e=>{e.exports=require("os")},5315:e=>{e.exports=require("path")},6162:e=>{e.exports=require("stream")},4175:e=>{e.exports=require("tty")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},1568:e=>{e.exports=require("zlib")},4169:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>x,requestAsyncStorage:()=>g,routeModule:()=>l,serverHooks:()=>y,staticGenerationAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{POST:()=>u,dynamic:()=>d});var a=r(3278),i=r(5002),n=r(4877),o=r(1309),p=r(6137),c=r(9812);let d="force-dynamic";async function u(){try{console.log("Starting data update from Calgary Open Data...");let e=await (0,p.rM)(),t=(0,c.g4)(e);return console.log(`Successfully updated ${t.length} properties`),o.NextResponse.json({success:!0,updated:t.length,timestamp:new Date().toISOString()})}catch(e){return console.error("Update Error:",e),o.NextResponse.json({success:!1,error:"Failed to update properties"},{status:500})}}let l=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/update/route",pathname:"/api/update",filename:"route",bundlePath:"app/api/update/route"},resolvedPagePath:"C:\\Users\\KeyWest\\Desktop\\PROJECTS\\calgary.ypilo.com\\src\\app\\api\\update\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:m,serverHooks:y}=l,h="/api/update/route";function x(){return(0,n.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:m})}},6137:(e,t,r)=>{r.d(t,{Nq:()=>p,rM:()=>o});var s=r(5932);let a="/vdjc-pybd.json",i=s.Z.create({baseURL:"https://data.calgary.ca/resource",timeout:6e4,headers:{Accept:"application/json"}});function n(e){return e.filter(e=>e.point?.coordinates&&e.tradename).map(e=>({licencenumber:e.getbusid||"",tradename:e.tradename||"",businesstype:e.licencetypes?.split(",")[0]?.trim()||"Business",businesssubtype:e.licencetypes?.split("\n")[1]?.trim(),address:e.address||"",city:"Calgary",province:"AB",postalcode:"",latitude:String(e.point.coordinates[1]),longitude:String(e.point.coordinates[0]),licencetypes:e.licencetypes||"",licencestatus:e.jobstatusdesc||"Unknown",issueddate:e.first_iss_dt||"",expirydate:e.exp_dt,communitydistrict:e.comdistnm||"",ward:e.comdistcd||""}))}async function o(){try{console.log("Fetching Calgary business licenses from real API...");let e=0,t=[];for(;t.length<5e4;){let r=(await i.get(a,{params:{$limit:5e3,$offset:e,$order:"first_iss_dt DESC"}})).data||[];if(t.push(...r),console.log(`Fetched batch: ${r.length}, total: ${t.length}`),r.length<5e3)break;e+=5e3}t.length>=5e4&&console.warn("Reached hard cap (50000). Consider increasing cap or adding server-side caching.");let r=n(t);return console.log(`Transformed to ${r.length} valid properties with coordinates`),r}catch(e){throw console.error("Error fetching Calgary properties:",e.response?.data||e.message),e}}async function p(e){try{let t=await i.get(a,{params:{$limit:500,$q:e}});return n(t.data)}catch(e){return console.error("Error searching properties:",e),[]}}},9812:(e,t,r)=>{function s(e){return e.filter(e=>e.latitude&&e.longitude).map(e=>({id:e.licencenumber,name:e.tradename||"Unnamed Business",type:e.businesstype,subType:e.businesssubtype,address:`${e.address}, ${e.city}, ${e.province} ${e.postalcode}`,coordinates:[parseFloat(e.longitude),parseFloat(e.latitude)],status:function(e){let t=e?.toLowerCase()||"";return t.includes("move in progress")||t.includes("close in progress")?"in_progress":t.includes("pending renewal")||t.includes("renewal invoiced")||t.includes("renewal notification sent")?"pending":(t.includes("licensed"),"active")}(e.licencestatus),issuedDate:e.issueddate,expiryDate:e.expirydate,community:e.communitydistrict,ward:e.ward,postalCode:e.postalcode}))}r.d(t,{g4:()=>s})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[787,833,932],()=>r(4169));module.exports=s})();