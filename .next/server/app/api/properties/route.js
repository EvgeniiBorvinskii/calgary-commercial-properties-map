"use strict";(()=>{var e={};e.id=805,e.ids=[805],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7790:e=>{e.exports=require("assert")},4770:e=>{e.exports=require("crypto")},7702:e=>{e.exports=require("events")},2048:e=>{e.exports=require("fs")},2615:e=>{e.exports=require("http")},2694:e=>{e.exports=require("http2")},5240:e=>{e.exports=require("https")},9801:e=>{e.exports=require("os")},5315:e=>{e.exports=require("path")},6162:e=>{e.exports=require("stream")},4175:e=>{e.exports=require("tty")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},1568:e=>{e.exports=require("zlib")},5360:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>b,patchFetch:()=>v,requestAsyncStorage:()=>y,routeModule:()=>h,serverHooks:()=>x,staticGenerationAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{GET:()=>m,dynamic:()=>l,maxDuration:()=>u,revalidate:()=>d});var i=r(3278),o=r(5002),a=r(4877),n=r(1309),c=r(6137),p=r(9812);let l="force-dynamic",d=0,u=60,g=null;async function m(e){try{let t;console.log("[API] Starting properties fetch...");let r=e.nextUrl.searchParams,s=r.get("address"),i=r.get("type"),o=r.get("status"),a=r.get("bbox");if(s)console.log("[API] Searching by address:",s),t=await (0,c.Nq)(s);else{console.log("[API] Fetching all properties...");let e=Date.now();g&&e-g.timestamp<6e5?(console.log("[API] Using cached dataset"),t=g.rawData):(t=await (0,c.rM)(),g={timestamp:e,rawData:t})}console.log("[API] Raw data count:",t.length);let l=(0,p.g4)(t);if(console.log("[API] Transformed properties:",l.length),a){let e=a.split(",").map(e=>Number(e.trim()));if(4===e.length&&e.every(e=>Number.isFinite(e))){let[t,r,s,i]=e;l=l.filter(e=>{let[o,a]=e.coordinates;return o>=t&&o<=s&&a>=r&&a<=i})}}return i&&(l=l.filter(e=>e.type===i)),o&&(l=l.filter(e=>e.status===o)),console.log("[API] Final properties count:",l.length),n.NextResponse.json({success:!0,count:l.length,data:l,timestamp:new Date().toISOString()})}catch(e){return console.error("[API] Error:",e),n.NextResponse.json({success:!1,error:e.message||"Failed to fetch properties",details:void 0},{status:500})}}let h=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/properties/route",pathname:"/api/properties",filename:"route",bundlePath:"app/api/properties/route"},resolvedPagePath:"C:\\Users\\KeyWest\\Desktop\\PROJECTS\\calgary.ypilo.com\\src\\app\\api\\properties\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:y,staticGenerationAsyncStorage:f,serverHooks:x}=h,b="/api/properties/route";function v(){return(0,a.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:f})}},6137:(e,t,r)=>{r.d(t,{Nq:()=>c,rM:()=>n});var s=r(5932);let i="/vdjc-pybd.json",o=s.Z.create({baseURL:"https://data.calgary.ca/resource",timeout:6e4,headers:{Accept:"application/json"}});function a(e){return e.filter(e=>e.point?.coordinates&&e.tradename).map(e=>({licencenumber:e.getbusid||"",tradename:e.tradename||"",businesstype:e.licencetypes?.split(",")[0]?.trim()||"Business",businesssubtype:e.licencetypes?.split("\n")[1]?.trim(),address:e.address||"",city:"Calgary",province:"AB",postalcode:"",latitude:String(e.point.coordinates[1]),longitude:String(e.point.coordinates[0]),licencetypes:e.licencetypes||"",licencestatus:e.jobstatusdesc||"Unknown",issueddate:e.first_iss_dt||"",expirydate:e.exp_dt,communitydistrict:e.comdistnm||"",ward:e.comdistcd||""}))}async function n(){try{console.log("Fetching Calgary business licenses from real API...");let e=0,t=[];for(;t.length<5e4;){let r=(await o.get(i,{params:{$limit:5e3,$offset:e,$order:"first_iss_dt DESC"}})).data||[];if(t.push(...r),console.log(`Fetched batch: ${r.length}, total: ${t.length}`),r.length<5e3)break;e+=5e3}t.length>=5e4&&console.warn("Reached hard cap (50000). Consider increasing cap or adding server-side caching.");let r=a(t);return console.log(`Transformed to ${r.length} valid properties with coordinates`),r}catch(e){throw console.error("Error fetching Calgary properties:",e.response?.data||e.message),e}}async function c(e){try{let t=await o.get(i,{params:{$limit:500,$q:e}});return a(t.data)}catch(e){return console.error("Error searching properties:",e),[]}}},9812:(e,t,r)=>{function s(e){return e.filter(e=>e.latitude&&e.longitude).map(e=>({id:e.licencenumber,name:e.tradename||"Unnamed Business",type:e.businesstype,subType:e.businesssubtype,address:`${e.address}, ${e.city}, ${e.province} ${e.postalcode}`,coordinates:[parseFloat(e.longitude),parseFloat(e.latitude)],status:function(e){let t=e?.toLowerCase()||"";return t.includes("move in progress")||t.includes("close in progress")?"in_progress":t.includes("pending renewal")||t.includes("renewal invoiced")||t.includes("renewal notification sent")?"pending":(t.includes("licensed"),"active")}(e.licencestatus),issuedDate:e.issueddate,expiryDate:e.expirydate,community:e.communitydistrict,ward:e.ward,postalCode:e.postalcode}))}r.d(t,{g4:()=>s})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[787,833,932],()=>r(5360));module.exports=s})();